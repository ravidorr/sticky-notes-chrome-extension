import{API_BASE_URL as e,FIREBASE_CONFIG as t}from'./config.js';const n={app:null,auth:null,currentUser:null,idToken:null,generatedKey:null};function o(e,o){try{const i=e(t),a=o(i);return n.app=i,n.auth=a,{app:i,auth:a};}catch(e){return i('Firebase initialization failed: '+e.message),{app:null,auth:null};}}function i(e){const t=document.getElementById('error');t&&(t.textContent=e,t.style.display='block');}function a(){const e=document.getElementById('error');e&&(e.style.display='none');}function r(e,t,n){e&&(e.textContent=t,e.disabled=n);}function s(e){const t=document.getElementById('userInfo');t&&(t.textContent=`Signed in as: ${e}`,t.style.display='block');}function l(){const e=document.getElementById('step2');e&&(e.style.display='block');}function u(t){const o=document.getElementById('apiKeyDisplay'),i=document.getElementById('curlExample'),a=document.getElementById('result');o&&(o.textContent=t),i&&(i.textContent=`curl "${e}/notes" \\\n  -H "Authorization: Bearer ${t}"`),a&&(a.style.display='block'),n.generatedKey=t;}function c(e){return'read'===e?['notes:read']:'write'===e?['notes:write']:['notes:read','notes:write'];}async function d(e={}){const{signInWithPopup:t,GoogleAuthProvider:o,auth:u=n.auth}=e;if(!u||!t||!o)return i('Sign in is not available'),null;const c=document.getElementById('signInBtn'),d=c?.textContent||'Sign In';a(),r(c,'Signing in...',!0);try{const e=new o,i=(await t(u,e)).user,a=await i.getIdToken();return n.currentUser=i,n.idToken=a,s(i.email),r(c,'Signed In',!0),l(),{user:i,token:a};}catch(e){if(r(c,d,!1),'auth/popup-blocked'===e.code)i('Popup was blocked. Please allow popups for this site and try again.');else if('auth/popup-closed-by-user'===e.code)i('Sign in was cancelled. Please try again.');else{if('auth/cancelled-popup-request'===e.code)return null;i('Sign in failed: '+e.message);}return null;}}async function p(t={}){const{idToken:o=n.idToken,fetchFn:s=fetch}=t;if(!o)return i('Please sign in first'),null;const l=document.getElementById('generateBtn'),d=document.getElementById('keyName'),p=document.getElementById('scopes'),g=l?.textContent||'Generate Key',y=d?.value||'API Key',m=c(p?.value||'both');a(),r(l,'Generating...',!0);try{const t=await s(`${e}/keys`,{method:'POST',headers:{Authorization:`Bearer ${o}`,'Content-Type':'application/json'},body:JSON.stringify({name:y,scopes:m})}),n=await t.json();if(!t.ok)throw new Error(n.message||'Failed to generate key');return u(n.key),r(l,'Key Generated',!0),n.key;}catch(e){return r(l,g,!1),i('Failed to generate key: '+e.message),null;}}async function g(){if(!n.generatedKey)return!1;try{await navigator.clipboard.writeText(n.generatedKey);const e=document.getElementById('copyBtn');if(e){const t=e.textContent;e.textContent='Copied!',setTimeout(()=>{e.textContent=t;},2e3);}return!0;}catch(e){return i('Failed to copy to clipboard'),!1;}}function y(e={}){const{signInWithPopup:t,GoogleAuthProvider:n}=e,o=document.getElementById('signInBtn'),i=document.getElementById('generateBtn'),a=document.getElementById('copyBtn');o&&o.addEventListener('click',()=>{d({signInWithPopup:t,GoogleAuthProvider:n});}),i&&i.addEventListener('click',()=>{p({});}),a&&a.addEventListener('click',g);}async function m(e={}){const{initializeApp:t,getAuth:n,signInWithPopup:i,GoogleAuthProvider:a}=e;t&&n&&o(t,n),y({signInWithPopup:i,GoogleAuthProvider:a});}'undefined'!==typeof document&&'undefined'!==typeof window&&Promise.all([import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'),import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js')]).then(([e,t])=>{m({initializeApp:e.initializeApp,getAuth:t.getAuth,signInWithPopup:t.signInWithPopup,GoogleAuthProvider:t.GoogleAuthProvider});}).catch(e=>{console.error('Failed to load Firebase:',e),i('Failed to load authentication service');});export{n as state,o as initializeFirebase,i as showError,a as hideError,r as updateButton,s as showUserInfo,l as showStep2,u as displayGeneratedKey,c as getScopes,d as handleSignIn,p as handleGenerateKey,g as handleCopyKey,y as setupEventListeners,m as init};